<link rel="stylesheet" type="text/css" href="/stylesheets/jquery.alerts.css" />

<style>
  button{
      width: 20%;
  }
</style>

<div class="panel panel-info" style="width: 98%; margin-left: auto;margin-right: auto;">
  <div class="panel-heading">
    <h3 class="panel-title">User List</h3>
  </div>
  <div class="panel-body">
    <table id="users" class="table table-striped table-hover ">
      <thead>
      <tr>
        <th>Username</th>
        <th>User Role</th>
        <th>Last Updated On</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody>
      <% @user.each do |user| %>
          <tr>
            <td><%= user.username %></td>
            <td><%= user.user_role.role.role  rescue ""%></td>
            <td><%= user.updated_at.to_date.strftime("%d %B %Y") %></td>
            <td>
              <button onmousedown="delete_user(<%= user.id%>)" class="btn btn-danger btn-sm" >Void</button>
              <button onmousedown="window.location='/user/edit_user?user_name=<%= user.username %>'" class="btn btn-success btn-sm">Edit</button>
            </td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</div>

<script type="text/javascript" language="javascript" src="/javascripts/jquery-1.8.2.js"></script>
<script type="text/javascript" language="javascript" src="/javascripts/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="/javascripts/jquery.alerts.js"></script>
<script type="text/javascript" charset="utf-8">

        $('#users').dataTable({
            "aaSorting": [[ 2, "desc" ]],
            'iDisplayLength': 7,
            "bLengthChange": false
        });

        function delete_user(id)
        {
            jConfirm("Are you sure you want to void this user? ","Confirmation Dialog",function(r)
            {
                if (r)
                {
                    jQuery.ajax({
                        url:  "/user/delete?user_id=" + id ,
                        type:"POST",
                        success: function(msg){
                            jAlert(msg, "User Deletion Outcome")
                            window.location = "/user/edit"
                        },
                        error: function(){
                            jAlert("Could not delete user", "Unsuccessful!");
                        }

                    });
                }
            })
        }
</script>